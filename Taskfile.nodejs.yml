version: '3'

includes:
  npm:
    taskfile: Taskfile.npm.yml
    internal: true
  shell:
    taskfile: Taskfile.shell.yml
    internal: true

tasks:

  run:
    desc: Run compiled JavaScript file with Node.js
    label: nodejs:run:{{.FILE}}
    dir: '{{.USER_WORKING_DIR}}'
    interactive: true
    vars:
      FILE: '{{.FILE | default "dist/index.js"}}'
      SPINNER_TITLE: '{{.SPINNER_TITLE | default (printf "Running node %s" .FILE)}}'
      STDERR: '{{.STDERR | default .DEFAULT_STDERR}}'
      STDOUT: '{{.STDOUT | default .DEFAULT_STDOUT}}'
    cmds:
      - node {{.FILE}}

  run-exec:
    desc: Run compiled JavaScript file in the specified packages
    label: nodejs:run-exec
    dir: '{{.ROOT_DIR}}'
    interactive: true
    vars:
      FILE: '{{.FILE | default "dist/index.js"}}'
      STDERR: '{{.STDERR | default .DEFAULT_STDERR}}'
      STDOUT: '{{.STDOUT | default .DEFAULT_STDOUT}}'
    cmds:
      - task: npm:exec
        vars:
          CLI_ARGS: task nodejs:run FILE={{.FILE}}
          SPINNER_TITLE: '{{.SPINNER_TITLE}}'
